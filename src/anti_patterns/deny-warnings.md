# `#![deny(warnings)]`

## Описание

Автор крейта с хорошими намерениями хочет убедиться, что его код собирается без предупреждений. Поэтому он аннотирует корневой крейт следующим образом:

## Пример

```rust
#![deny(warnings)]

// All is well.
```

## Преимущества

Это коротко и остановит сборку, если что-то не так.

## Недостатки

Запретив компилятору собирать с предупреждениями, автор крейта отказывается от знаменитой стабильности Rust. Иногда новые функции или старые ошибки требуют изменения способа выполнения задач, поэтому создаются линты, которые предупреждают о необходимости изменений в течение определенного периода времени, прежде чем они станут запрещенными.

Например, было обнаружено, что тип может иметь два `impl` с одним и тем же методом. Это было признано плохой идеей, но для того, чтобы сделать переход плавным, был введен линт `overlapping-inherent-impls`, который предупреждает тех, кто сталкивается с этим фактом, прежде чем это станет жесткой ошибкой в будущем релизе.

Также иногда API устаревают, поэтому их использование будет выдавать предупреждение, где раньше его не было.

Все это может привести к потенциальному нарушению сборки при любом изменении.

Кроме того, крейты, которые предоставляют дополнительные линты (например, [rust-clippy]), больше не могут использоваться, если аннотация не удалена. Это уменьшается с помощью [--cap-lints]. Аргумент командной строки `--cap-lints=warn` превращает все ошибки линтов `deny` в предупреждения.

## Альтернативы

Есть два способа решения этой проблемы: во-первых, мы можем отделить настройку сборки от кода, а во-вторых, мы можем явно указать линты, которые мы хотим запретить.

Следующая команда сборки установит все предупреждения на `deny`:

`RUSTFLAGS="-D warnings" cargo build`

Это может сделать любой отдельный разработчик (или быть установлено в инструменте CI, но помните, что это может нарушить сборку при любом изменении) без необходимости изменения кода.

В качестве альтернативы мы можем указать линты, которые мы хотим запретить в коде. Вот список линтов предупреждений, которые (надеюсь) безопасно запрещать (на момент Rustc 1.48.0):

```rust,ignore
#![deny(bad_style,
       const_err,
       dead_code,
       improper_ctypes,
       non_shorthand_field_patterns,
       no_mangle_generic_items,
       overflowing_literals,
       path_statements,
       patterns_in_fns_without_body,
       private_in_public,
       unconditional_recursion,
       unused,
       unused_allocation,
       unused_comparisons,
       unused_parens,
       while_true)]
```

Кроме того, следующие линты `allow` могут быть хорошей идеей для запрета:

```rust,ignore
#![deny(missing_debug_implementations,
       missing_docs,
       trivial_casts,
       trivial_numeric_casts,
       unused_extern_crates,
       unused_import_braces,
       unused_qualifications,
       unused_results)]
```

Некоторые могут также захотеть добавить `missing-copy-implementations` в свой список.

Обратите внимание, что мы явно не добавили линт `deprecated`, так как довольно вероятно, что в будущем будут появляться более устаревшие API.

## Смотрите также

- [Коллекция всех линтов clippy](https://rust-lang.github.io/rust-clippy/master)
- [атрибут устаревания] документация
- Введите `rustc -W help`, чтобы получить список линтов на вашей системе. Также введите `rustc --help`, чтобы получить общий список опций
- [rust-clippy] - это коллекция линтов для лучшего кода Rust

[rust-clippy]: https://github.com/Manishearth/rust-clippy
[атрибут устаревания]: https://doc.rust-lang.org/reference/attributes.html#deprecation
[--cap-lints]: https://doc.rust-lang.org/rustc/lints/levels.html#capping-lints
